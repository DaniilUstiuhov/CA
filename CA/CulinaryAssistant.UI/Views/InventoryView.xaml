<UserControl x:Class="CulinaryAssistant.UI.Views.InventoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:CulinaryAssistant.UI.Converters"
             mc:Ignorable="d">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:EnumToStringConverter x:Key="EnumToStringConverter"/>
        <converters:ExpirationToColorConverter x:Key="ExpirationToColorConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0">
                <TextBlock Text="Ð˜Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ" 
                           FontSize="28" FontWeight="Bold" 
                           Foreground="{DynamicResource TextBrush}"/>
                <TextBlock FontSize="14" 
                           Foreground="{DynamicResource MutedTextBrush}"
                           Margin="0,4,0,0">
                    <Run Text="{Binding Items.Count, StringFormat='Ð’ÑÐµÐ³Ð¾: {0}', Mode=OneWay}"/>
                    <Run Text=" Â· "/>
                    <Run Text="{Binding ExpiredCount, StringFormat='ÐŸÑ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð¾: {0}', Mode=OneWay}" Foreground="#C42B1C"/>
                    <Run Text=" Â· "/>
                    <Run Text="{Binding ExpiringSoonCount, StringFormat='Ð˜ÑÑ‚ÐµÐºÐ°ÐµÑ‚: {0}', Mode=OneWay}" Foreground="#FFB900"/>
                </TextBlock>
            </StackPanel>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="ðŸ“¤ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV" 
                        Command="{Binding ExportCommand}"
                        Padding="16,8"
                        Margin="0,0,12,0"/>
                <Button Content="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ" 
                        Command="{Binding AddItemCommand}"
                        Background="#0078D4"
                        Foreground="White"
                        Padding="16,8"/>
            </StackPanel>
        </Grid>
        
        <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ -->
        <Border Grid.Row="1" 
                Background="#2D2D30" 
                CornerRadius="12" 
                Padding="16" 
                Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBox Grid.Column="0" 
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Padding="8"
                         Margin="0,0,12,0"/>
                
                <CheckBox Grid.Column="1" 
                          Content="Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð½Ñ‹Ðµ"
                          IsChecked="{Binding ShowExpiredOnly}"
                          VerticalAlignment="Center"
                          Foreground="White"
                          Margin="0,0,12,0"/>
                
                <CheckBox Grid.Column="2" 
                          Content="Ð˜ÑÑ‚ÐµÐºÐ°ÐµÑ‚ ÑÐºÐ¾Ñ€Ð¾"
                          IsChecked="{Binding ShowExpiringSoonOnly}"
                          VerticalAlignment="Center"
                          Foreground="White"
                          Margin="0,0,12,0"/>
                
                <Button Grid.Column="3" 
                        Content="Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ" 
                        Command="{Binding ResetFiltersCommand}"
                        Padding="16,8"/>
            </Grid>
        </Border>
        
        <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ñ -->
        <Border Grid.Row="2" 
                Background="#2D2D30" 
                CornerRadius="12">
            <DataGrid ItemsSource="{Binding Items}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      Background="Transparent"
                      BorderThickness="0"
                      Foreground="White">
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ" Binding="{Binding Name}" Width="*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾" Width="120">
                        <DataGridTextColumn.Binding>
                            <MultiBinding StringFormat="{}{0} {1}">
                                <Binding Path="Quantity"/>
                                <Binding Path="Unit" Converter="{StaticResource EnumToStringConverter}"/>
                            </MultiBinding>
                        </DataGridTextColumn.Binding>
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="ÐœÐµÑÑ‚Ð¾ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ" Binding="{Binding StorageLocation}" Width="150">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Ð¡Ñ€Ð¾Ðº Ð³Ð¾Ð´Ð½Ð¾ÑÑ‚Ð¸" Binding="{Binding ExpirationDate, StringFormat='dd.MM.yyyy'}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="8"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="4" Padding="8,4"
                                        Background="{Binding ., Converter={StaticResource ExpirationToColorConverter}}"
                                        HorizontalAlignment="Left"
                                        Margin="4">
                                    <TextBlock Foreground="White" FontSize="11">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="Ð’ Ð½Ð¾Ñ€Ð¼Ðµ"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsExpired}" Value="True">
                                                        <Setter Property="Text" Value="ÐŸÑ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð¾"/>
                                                    </DataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding IsExpired}" Value="False"/>
                                                            <Condition Binding="{Binding IsExpiringSoon}" Value="True"/>
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter Property="Text" Value="Ð˜ÑÑ‚ÐµÐºÐ°ÐµÑ‚"/>
                                                    </MultiDataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ" Width="160">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="4">
                                    <Button Content="âˆ’" ToolTip="Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ"
                                            Command="{Binding DataContext.UseItemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="28" Height="28"
                                            Margin="0,0,4,0"/>
                                    <Button Content="+" ToolTip="ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ"
                                            Command="{Binding DataContext.ReplenishItemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="28" Height="28"
                                            Margin="0,0,4,0"/>
                                    <Button Content="âœ" ToolTip="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                                            Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="28" Height="28"
                                            Margin="0,0,4,0"/>
                                    <Button Content="ðŸ—‘" ToolTip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                            Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                            Width="28" Height="28"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
